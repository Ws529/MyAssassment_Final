<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manajemen KD & KKM - My Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: #333; background-color: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        .navbar { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; top: 0; width: 100%; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; height: 70px; }
        .nav-brand { display: flex; align-items: center; font-size: 24px; font-weight: 600; color: #24b0ba; gap: 10px; text-decoration: none; }
        .nav-menu { display: flex; align-items: center; gap: 30px; }
        .nav-link { text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #24b0ba; }
        .btn-primary { background: linear-gradient(135deg, #24b0ba, #73ced5); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-weight: 500; cursor: pointer; text-decoration: none; }
        
        .page-header { background: linear-gradient(135deg, #24b0ba, #73ced5); color: white; padding: 120px 0 60px; margin-top: 70px; text-align: center; }
        .page-header h1 { font-size: 36px; font-weight: 600; margin-bottom: 10px; }
        .page-header p { font-size: 18px; opacity: 0.9; }
        
        .page-content { padding: 40px 0; min-height: 60vh; }
        
        .action-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); flex-wrap: wrap; gap: 15px; }
        .search-filter { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .search-input { padding: 12px 20px; border: 2px solid #e9ecef; border-radius: 25px; font-size: 14px; width: 250px; outline: none; }
        .search-input:focus { border-color: #24b0ba; }
        .form-select { padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 25px; font-size: 14px; outline: none; font-family: 'Poppins', sans-serif; }
        .btn-search { background: #24b0ba; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: 500; cursor: pointer; }
        .action-buttons { display: flex; gap: 15px; }
        .btn-secondary { background: #6c757d; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: 500; cursor: pointer; }
        
        .form-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px; display: none; }
        .form-card.active { display: block; }
        .form-card h3 { font-size: 24px; font-weight: 600; margin-bottom: 25px; color: #333; border-bottom: 2px solid #24b0ba; padding-bottom: 10px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { font-weight: 500; margin-bottom: 8px; color: #333; }
        .form-input { padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; outline: none; font-family: 'Poppins', sans-serif; }
        .form-input:focus { border-color: #24b0ba; }
        .form-actions { display: flex; gap: 15px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid #e9ecef; }
        
        .data-grid { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .grid-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .grid-table th { background: linear-gradient(135deg, #24b0ba, #73ced5); color: white; padding: 15px; text-align: left; font-weight: 600; }
        .grid-table td { padding: 15px; border-bottom: 1px solid #e9ecef; vertical-align: middle; }
        .grid-table tr:hover { background: #f8f9fa; }
        .btn-edit { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 12px; cursor: pointer; margin-right: 5px; }
        .btn-delete { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 12px; cursor: pointer; }
        
        .badge { padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; }
        .badge-ki3 { background: #e3f2fd; color: #1976d2; }
        .badge-ki4 { background: #fce4ec; color: #c2185b; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .empty-state h3 { font-size: 24px; margin-bottom: 10px; color: #333; }
        
        .message { padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; display: block; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; display: block; }
        
        .footer { background: #2c3e50; color: white; padding: 30px 0; text-align: center; margin-top: 60px; }
        
        @media (max-width: 768px) {
            .action-bar { flex-direction: column; align-items: stretch; }
            .search-input { width: 100%; }
            .nav-menu { display: none; }
            .grid-table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <span>ðŸ“Š</span>
                <span>My Assessment</span>
            </a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Beranda</a>
                <a href="siswa.html" class="nav-link">Data Siswa</a>
                <a href="kompetensi.html" class="nav-link active">KD & KKM</a>
                <a href="penilaian.html" class="nav-link">Penilaian</a>
                <a href="pengaturan.html" class="btn-primary">Pengaturan</a>
            </div>
        </div>
    </nav>

    <section class="page-header">
        <div class="container">
            <h1>Manajemen KD & KKM</h1>
            <p>Kelola Kompetensi Dasar KI-3 & KI-4 serta nilai KKM mata pelajaran</p>
        </div>
    </section>

    <section class="page-content">
        <div class="container">
            <div class="message" id="message"></div>

            <div class="action-bar">
                <div class="search-filter">
                    <input type="text" class="search-input" id="searchInput" placeholder="Cari KD..." onkeyup="searchKD()">
                    <select class="form-select" id="filterMapel" onchange="filterKD()">
                        <option value="">Semua Mapel</option>
                    </select>
                    <select class="form-select" id="filterType" onchange="filterKD()">
                        <option value="">Semua Jenis</option>
                        <option value="KI-3">KI-3 (Pengetahuan)</option>
                        <option value="KI-4">KI-4 (Keterampilan)</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" onclick="showForm()">+ Tambah KD</button>
                    <button class="btn-secondary" onclick="exportCSV()">ðŸ“Š Export CSV</button>
                </div>
            </div>

            <div class="form-card" id="formCard">
                <h3 id="formTitle">Tambah Kompetensi Dasar Baru</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Kode KD</label>
                        <input type="text" class="form-input" id="kodeKD" placeholder="Contoh: 3.1, 4.1">
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <select class="form-input" id="mapel">
                            <option value="">Pilih Mata Pelajaran</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Kelas</label>
                        <select class="form-input" id="kelas">
                            <option value="">Pilih Kelas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Jenis KI</label>
                        <select class="form-input" id="jenisKI">
                            <option value="">Pilih Jenis KI</option>
                            <option value="KI-3">KI-3 (Pengetahuan)</option>
                            <option value="KI-4">KI-4 (Keterampilan)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>KKM</label>
                        <input type="number" class="form-input" id="kkm" placeholder="75" value="75" min="0" max="100">
                    </div>
                    <div class="form-group full-width">
                        <label>Deskripsi Kompetensi Dasar</label>
                        <textarea class="form-input" id="deskripsi" rows="3" placeholder="Masukkan deskripsi lengkap KD"></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn-primary" onclick="saveKD()">Simpan</button>
                    <button class="btn-secondary" onclick="hideForm()">Batal</button>
                </div>
            </div>

            <div class="data-grid">
                <table class="grid-table" id="kdTable">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Kode KD</th>
                            <th>Mata Pelajaran</th>
                            <th>Kelas</th>
                            <th>Jenis</th>
                            <th>Deskripsi</th>
                            <th>KKM</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="kdBody"></tbody>
                </table>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>Â© 2026 My Assessment - Sistem Penilaian Kurikulum 2013</p>
        </div>
    </footer>

    <script>
        // Get data from localStorage
        let kelasList = JSON.parse(localStorage.getItem('kelasList')) || ['X IPA 1', 'X IPA 2', 'X IPS 1', 'XI IPA 1', 'XI IPA 2', 'XI IPS 1', 'XII IPA 1', 'XII IPA 2'];
        let mapelList = JSON.parse(localStorage.getItem('mapelList')) || ['Matematika', 'Fisika', 'Kimia', 'Biologi', 'Bahasa Indonesia', 'Bahasa Inggris', 'Sejarah', 'Geografi', 'Ekonomi'];
        
        let competencies = JSON.parse(localStorage.getItem('competenciesList')) || [
            { id: 1, kode: '3.1', mapel: 'Matematika', kelas: 'X IPA 1', jenis: 'KI-3', deskripsi: 'Menjelaskan dan menentukan penyelesaian sistem persamaan linear dua variabel', kkm: 75 },
            { id: 2, kode: '3.2', mapel: 'Matematika', kelas: 'X IPA 1', jenis: 'KI-3', deskripsi: 'Menjelaskan dan menentukan penyelesaian pertidaksamaan linear satu variabel', kkm: 75 },
            { id: 3, kode: '4.1', mapel: 'Matematika', kelas: 'X IPA 1', jenis: 'KI-4', deskripsi: 'Menyelesaikan masalah kontekstual yang berkaitan dengan sistem persamaan linear dua variabel', kkm: 75 },
            { id: 4, kode: '3.1', mapel: 'Fisika', kelas: 'X IPA 1', jenis: 'KI-3', deskripsi: 'Menerapkan hakikat ilmu Fisika, metode ilmiah, dan keselamatan kerja di laboratorium', kkm: 75 },
            { id: 5, kode: '4.1', mapel: 'Fisika', kelas: 'X IPA 1', jenis: 'KI-4', deskripsi: 'Membuat prosedur kerja ilmiah dan keselamatan kerja di laboratorium', kkm: 75 },
        ];

        let editingId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadDropdownOptions();
            renderKD();
        });

        function loadDropdownOptions() {
            // Filter Mapel
            const filterMapel = document.getElementById('filterMapel');
            filterMapel.innerHTML = '<option value="">Semua Mapel</option>';
            mapelList.forEach(m => filterMapel.innerHTML += `<option value="${m}">${m}</option>`);
            
            // Form Mapel
            const formMapel = document.getElementById('mapel');
            formMapel.innerHTML = '<option value="">Pilih Mata Pelajaran</option>';
            mapelList.forEach(m => formMapel.innerHTML += `<option value="${m}">${m}</option>`);
            
            // Form Kelas
            const formKelas = document.getElementById('kelas');
            formKelas.innerHTML = '<option value="">Pilih Kelas</option>';
            kelasList.forEach(k => formKelas.innerHTML += `<option value="${k}">${k}</option>`);
        }

        function renderKD(data = competencies) {
            const tbody = document.getElementById('kdBody');
            
            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <h3>Belum ada data Kompetensi Dasar</h3>
                                <p>Klik tombol "Tambah KD" untuk menambah data baru</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = data.map((kd, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td><strong>${kd.kode}</strong></td>
                    <td>${kd.mapel}</td>
                    <td>${kd.kelas}</td>
                    <td><span class="badge ${kd.jenis === 'KI-3' ? 'badge-ki3' : 'badge-ki4'}">${kd.jenis}</span></td>
                    <td>${kd.deskripsi.substring(0, 50)}...</td>
                    <td><strong>${kd.kkm}</strong></td>
                    <td>
                        <button class="btn-edit" onclick="editKD(${kd.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteKD(${kd.id})">Hapus</button>
                    </td>
                </tr>
            `).join('');
        }

        function showForm() {
            document.getElementById('formCard').classList.add('active');
            document.getElementById('formTitle').textContent = 'Tambah Kompetensi Dasar Baru';
            clearForm();
            editingId = null;
        }

        function hideForm() {
            document.getElementById('formCard').classList.remove('active');
            clearForm();
            editingId = null;
        }

        function clearForm() {
            document.getElementById('kodeKD').value = '';
            document.getElementById('mapel').value = '';
            document.getElementById('kelas').value = '';
            document.getElementById('jenisKI').value = '';
            document.getElementById('kkm').value = '75';
            document.getElementById('deskripsi').value = '';
        }

        function saveKD() {
            const kode = document.getElementById('kodeKD').value;
            const mapel = document.getElementById('mapel').value;
            const kelas = document.getElementById('kelas').value;
            const jenis = document.getElementById('jenisKI').value;
            const kkm = parseInt(document.getElementById('kkm').value);
            const deskripsi = document.getElementById('deskripsi').value;

            if (!kode || !mapel || !kelas || !jenis || !deskripsi) {
                showMessage('Mohon lengkapi semua data!', 'error');
                return;
            }

            if (editingId) {
                const index = competencies.findIndex(k => k.id === editingId);
                if (index !== -1) {
                    competencies[index] = { id: editingId, kode, mapel, kelas, jenis, deskripsi, kkm };
                }
                showMessage('Kompetensi Dasar berhasil diperbarui!', 'success');
            } else {
                const newId = Math.max(...competencies.map(k => k.id), 0) + 1;
                competencies.push({ id: newId, kode, mapel, kelas, jenis, deskripsi, kkm });
                showMessage('Kompetensi Dasar berhasil ditambahkan!', 'success');
            }

            hideForm();
            renderKD();
            localStorage.setItem('competenciesList', JSON.stringify(competencies));
        }

        function editKD(id) {
            const kd = competencies.find(k => k.id === id);
            if (kd) {
                document.getElementById('kodeKD').value = kd.kode;
                document.getElementById('mapel').value = kd.mapel;
                document.getElementById('kelas').value = kd.kelas;
                document.getElementById('jenisKI').value = kd.jenis;
                document.getElementById('kkm').value = kd.kkm;
                document.getElementById('deskripsi').value = kd.deskripsi;
                
                document.getElementById('formCard').classList.add('active');
                document.getElementById('formTitle').textContent = 'Edit Kompetensi Dasar';
                editingId = id;
            }
        }

        function deleteKD(id) {
            if (confirm('Yakin ingin menghapus Kompetensi Dasar ini?')) {
                competencies = competencies.filter(k => k.id !== id);
                localStorage.setItem('competenciesList', JSON.stringify(competencies));
                renderKD();
                showMessage('Kompetensi Dasar berhasil dihapus!', 'success');
            }
        }

        function searchKD() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = competencies.filter(k => 
                k.kode.toLowerCase().includes(searchTerm) || 
                k.deskripsi.toLowerCase().includes(searchTerm) ||
                k.mapel.toLowerCase().includes(searchTerm)
            );
            renderKD(filtered);
        }

        function filterKD() {
            const mapel = document.getElementById('filterMapel').value;
            const type = document.getElementById('filterType').value;
            
            let filtered = competencies;
            if (mapel) filtered = filtered.filter(k => k.mapel === mapel);
            if (type) filtered = filtered.filter(k => k.jenis === type);
            
            renderKD(filtered);
        }

        function exportCSV() {
            let csv = 'Kode KD,Mata Pelajaran,Kelas,Jenis KI,Deskripsi,KKM\n';
            competencies.forEach(k => {
                csv += `${k.kode},${k.mapel},${k.kelas},${k.jenis},"${k.deskripsi}",${k.kkm}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'KompetensiDasar.csv';
            a.click();
            
            showMessage('Data berhasil diekspor ke CSV!', 'success');
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => { msg.className = 'message'; }, 3000);
        }
    </script>
</body>
</html>