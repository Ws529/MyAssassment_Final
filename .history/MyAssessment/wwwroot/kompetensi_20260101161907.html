<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kompetensi Dasar - My Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f0f2f5; }
        .app-container { display: flex; min-height: 100vh; }

        /* Sidebar - Deep Ocean Drive Theme */
        .sidebar { width: 260px; background: linear-gradient(180deg, #24b0ba 0%, #156d73 60%, #0d2c2e 100%); color: #e2e8f0; position: fixed; height: 100vh; overflow-y: auto; z-index: 100; border-right: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 4px 0 15px rgba(0, 0, 0, 0.3); }
        .sidebar-header { padding: 25px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.1); }
        .sidebar-header img { width: 45px; height: 45px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .sidebar-header h2 { font-size: 20px; font-weight: 700; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .sidebar-header span { font-size: 11px; color: rgba(255,255,255,0.8); display: block; margin-top: 2px; }
        .sidebar-menu { padding: 20px 0; }
        .menu-label { padding: 15px 20px 8px; font-size: 10px; text-transform: uppercase; color: rgba(255,255,255,0.5); letter-spacing: 2px; font-weight: 600; }
        .menu-item { display: flex; align-items: center; gap: 14px; padding: 14px 20px; color: #e2e8f0; text-decoration: none; transition: all 0.3s ease; border-left: 4px solid transparent; margin: 2px 8px 2px 0; border-radius: 0 25px 25px 0; }
        .menu-item:hover { background: rgba(255, 255, 255, 0.1); color: #ffffff; border-left-color: rgba(255, 255, 255, 0.5); }
        .menu-item.active { background: rgba(255, 255, 255, 0.15); border-left-color: #ffffff; color: #ffffff; text-shadow: 0 0 10px #ffffff, 0 0 20px rgba(255,255,255,0.5); box-shadow: inset 0 0 20px rgba(255,255,255,0.1); }
        .menu-item .icon { font-size: 20px; width: 28px; text-align: center; }
        .sidebar-footer { position: absolute; bottom: 0; width: 100%; padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); }
        .logout-btn { display: flex; align-items: center; gap: 12px; color: #fca5a5; text-decoration: none; font-size: 14px; font-weight: 500; padding: 12px 15px; border-radius: 10px; transition: all 0.3s ease; }
        .logout-btn:hover { background: rgba(255,100,100,0.2); color: #ff8a8a; text-shadow: 0 0 10px rgba(255,100,100,0.5); }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; min-height: 100vh; }
        .top-header { background: linear-gradient(135deg, #24b0ba, #1a8a93); color: white; padding: 25px 30px; }
        .page-title h1 { font-size: 24px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .page-title p { font-size: 13px; opacity: 0.9; margin-top: 5px; }
        .content-area { padding: 25px 30px; }

        /* Action Bar */
        .action-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .search-box { display: flex; gap: 10px; align-items: center; }
        .search-input { padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; width: 280px; outline: none; }
        .search-input:focus { border-color: #24b0ba; }
        .filter-select { padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; outline: none; background: white; }

        /* Cards */
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 20px; }
        .card-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; font-weight: 600; color: #333; }
        .card-body { padding: 20px; }

        /* Form */
        .form-card { display: none; }
        .form-card.active { display: block; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .form-group label { display: block; font-size: 13px; font-weight: 500; color: #555; margin-bottom: 6px; }
        .form-control { width: 100%; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; outline: none; font-family: 'Poppins', sans-serif; }
        .form-control:focus { border-color: #24b0ba; }
        .form-actions { display: flex; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; }

        /* Table */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f8f9fa; padding: 12px 15px; text-align: left; font-size: 13px; font-weight: 600; color: #555; border-bottom: 2px solid #e0e0e0; }
        .data-table td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 14px; color: #333; }
        .data-table tr:hover { background: #f8fffe; }

        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s; font-family: 'Poppins', sans-serif; }
        .btn-primary { background: linear-gradient(135deg, #24b0ba, #1a8a93); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(36,176,186,0.4); }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-outline { background: transparent; border: 2px solid #24b0ba; color: #24b0ba; }
        .btn-outline:hover { background: #24b0ba; color: white; }

        /* Badge */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .badge-ki3 { background: #e3f2fd; color: #1976d2; }
        .badge-ki4 { background: #fce4ec; color: #c2185b; }

        /* Message */
        .message { padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; display: none; font-size: 14px; }
        .message.success { background: #d4edda; color: #155724; display: block; }
        .message.error { background: #f8d7da; color: #721c24; display: block; }

        .empty-state { text-align: center; padding: 50px 20px; color: #888; }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }

        @media (max-width: 992px) {
            .sidebar { width: 70px; }
            .sidebar-header h2, .sidebar-header span, .menu-label, .menu-item span { display: none; }
            .main-content { margin-left: 70px; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/img/logo.png" alt="Logo">
                <div><h2>MyAssessment</h2><span>Sistem Penilaian K13</span></div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-label">Menu Utama</div>
                <a href="index.html" class="menu-item"><span class="icon">üè†</span><span>Dashboard</span></a>
                <a href="siswa.html" class="menu-item"><span class="icon">üë•</span><span>Data Siswa</span></a>
                <a href="kompetensi.html" class="menu-item active"><span class="icon">üìö</span><span>Kompetensi Dasar</span></a>
                <a href="penilaian.html" class="menu-item"><span class="icon">üìù</span><span>Input Penilaian</span></a>
                <div class="menu-label">Laporan</div>
                <a href="penilaian.html" class="menu-item"><span class="icon">üìä</span><span>Rekap Nilai</span></a>
                <a href="penilaian.html" class="menu-item"><span class="icon">üìÑ</span><span>Cetak Rapor</span></a>
                <div class="menu-label">Pengaturan</div>
                <a href="pengaturan.html" class="menu-item"><span class="icon">‚öôÔ∏è</span><span>Pengaturan</span></a>
            </nav>
            <div class="sidebar-footer">
                <a href="login.html" class="logout-btn" onclick="logout()"><span>üö™</span><span>Logout</span></a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-header">
                <div class="page-title">
                    <h1>üìö Kompetensi Dasar & KKM</h1>
                    <p>Kelola KD KI-3 (Pengetahuan) dan KI-4 (Keterampilan)</p>
                </div>
            </div>

            <div class="content-area">
                <div class="message" id="message"></div>

                <div class="action-bar">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="üîç Cari KD..." onkeyup="searchKD()">
                        <select class="filter-select" id="filterMapel" onchange="filterKD()">
                            <option value="">Semua Mapel</option>
                        </select>
                        <select class="filter-select" id="filterKI" onchange="filterKD()">
                            <option value="">Semua KI</option>
                            <option value="KI-3">KI-3 (Pengetahuan)</option>
                            <option value="KI-4">KI-4 (Keterampilan)</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="showForm()">+ Tambah KD</button>
                    </div>
                </div>

                <!-- Form Card -->
                <div class="card form-card" id="formCard">
                    <div class="card-header">
                        <h3 id="formTitle">‚ûï Tambah Kompetensi Dasar</h3>
                        <button class="btn btn-sm btn-secondary" onclick="hideForm()">‚úï Tutup</button>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Kode KD</label>
                                <input type="text" class="form-control" id="kodeKD" placeholder="Contoh: 3.1">
                            </div>
                            <div class="form-group">
                                <label>Jenis KI</label>
                                <select class="form-control" id="jenisKI">
                                    <option value="">Pilih Jenis KI</option>
                                    <option value="KI-3">KI-3 (Pengetahuan)</option>
                                    <option value="KI-4">KI-4 (Keterampilan)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Mata Pelajaran</label>
                                <select class="form-control" id="mapel">
                                    <option value="">Pilih Mata Pelajaran</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>KKM</label>
                                <input type="number" class="form-control" id="kkm" placeholder="75" min="0" max="100">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Deskripsi KD</label>
                            <textarea class="form-control" id="deskripsi" rows="3" placeholder="Masukkan deskripsi kompetensi dasar"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveKD()">üíæ Simpan</button>
                            <button class="btn btn-secondary" onclick="hideForm()">Batal</button>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Daftar Kompetensi Dasar</h3>
                        <span id="totalCount">0 KD</span>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Kode</th>
                                    <th>Jenis</th>
                                    <th>Mata Pelajaran</th>
                                    <th>Deskripsi</th>
                                    <th>KKM</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="kdBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = '/api';
        let kdList = [];
        let mapelList = [];
        let editingId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadMapelOptions();
            loadKD();
        });

        async function loadMapelOptions() {
            try {
                const res = await fetch(`${API_URL}/mapel`);
                mapelList = await res.json();
                const filterMapel = document.getElementById('filterMapel');
                const formMapel = document.getElementById('mapel');
                filterMapel.innerHTML = '<option value="">Semua Mapel</option>';
                formMapel.innerHTML = '<option value="">Pilih Mata Pelajaran</option>';
                mapelList.forEach(m => {
                    filterMapel.innerHTML += `<option value="${m.nama}">${m.nama}</option>`;
                    formMapel.innerHTML += `<option value="${m.nama}">${m.nama}</option>`;
                });
            } catch (err) { console.error(err); }
        }

        async function loadKD() {
            try {
                const res = await fetch(`${API_URL}/kompetensi`);
                kdList = await res.json();
                renderKD();
            } catch (err) { showMessage('Gagal memuat data', 'error'); }
        }

        function renderKD(data = kdList) {
            const tbody = document.getElementById('kdBody');
            document.getElementById('totalCount').textContent = `${data.length} KD`;
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="icon">üìö</div><h4>Belum ada data KD</h4></div></td></tr>`;
                return;
            }

            tbody.innerHTML = data.map((kd, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${kd.kodeKD}</strong></td>
                    <td><span class="badge ${kd.jenisKI === 'KI-3' ? 'badge-ki3' : 'badge-ki4'}">${kd.jenisKI}</span></td>
                    <td>${kd.mapel}</td>
                    <td>${kd.deskripsi ? kd.deskripsi.substring(0, 50) + '...' : '-'}</td>
                    <td><strong>${kd.kkm}</strong></td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="editKD('${kd.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteKD('${kd.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function showForm() {
            document.getElementById('formCard').classList.add('active');
            document.getElementById('formTitle').textContent = '‚ûï Tambah Kompetensi Dasar';
            clearForm();
            editingId = null;
        }

        function hideForm() {
            document.getElementById('formCard').classList.remove('active');
            clearForm();
        }

        function clearForm() {
            ['kodeKD', 'jenisKI', 'mapel', 'kkm', 'deskripsi'].forEach(id => document.getElementById(id).value = '');
        }

        async function saveKD() {
            const kd = {
                kodeKD: document.getElementById('kodeKD').value,
                jenisKI: document.getElementById('jenisKI').value,
                mapel: document.getElementById('mapel').value,
                kkm: parseInt(document.getElementById('kkm').value) || 75,
                deskripsi: document.getElementById('deskripsi').value
            };

            if (!kd.kodeKD || !kd.jenisKI || !kd.mapel) {
                showMessage('Mohon lengkapi Kode KD, Jenis KI, dan Mapel!', 'error');
                return;
            }

            try {
                const url = editingId ? `${API_URL}/kompetensi/${editingId}` : `${API_URL}/kompetensi`;
                const method = editingId ? 'PUT' : 'POST';
                const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(kd) });
                const result = await res.json();
                showMessage(result.message, 'success');
                hideForm();
                loadKD();
            } catch (err) { showMessage('Gagal menyimpan', 'error'); }
        }

        function editKD(id) {
            const kd = kdList.find(x => x.id === id);
            if (kd) {
                document.getElementById('kodeKD').value = kd.kodeKD;
                document.getElementById('jenisKI').value = kd.jenisKI;
                document.getElementById('mapel').value = kd.mapel;
                document.getElementById('kkm').value = kd.kkm;
                document.getElementById('deskripsi').value = kd.deskripsi || '';
                document.getElementById('formCard').classList.add('active');
                document.getElementById('formTitle').textContent = '‚úèÔ∏è Edit Kompetensi Dasar';
                editingId = id;
            }
        }

        async function deleteKD(id) {
            if (confirm('Yakin ingin menghapus KD ini?')) {
                try {
                    const res = await fetch(`${API_URL}/kompetensi/${id}`, { method: 'DELETE' });
                    const result = await res.json();
                    showMessage(result.message, 'success');
                    loadKD();
                } catch (err) { showMessage('Gagal menghapus', 'error'); }
            }
        }

        function searchKD() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            renderKD(kdList.filter(kd => kd.kodeKD.toLowerCase().includes(term) || kd.deskripsi?.toLowerCase().includes(term)));
        }

        function filterKD() {
            const mapel = document.getElementById('filterMapel').value;
            const ki = document.getElementById('filterKI').value;
            let filtered = kdList;
            if (mapel) filtered = filtered.filter(kd => kd.mapel === mapel);
            if (ki) filtered = filtered.filter(kd => kd.jenisKI === ki);
            renderKD(filtered);
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => msg.className = 'message', 3000);
        }

        function logout() {
            localStorage.removeItem('userSession');
            sessionStorage.removeItem('userSession');
        }
    </script>
</body>
</html>
