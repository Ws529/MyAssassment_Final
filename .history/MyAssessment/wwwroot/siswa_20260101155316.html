<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Siswa - My Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="assets/css/neon-buttons.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f0f2f5; }

        /* Layout */
        .app-container { display: flex; min-height: 100vh; }

        /* Sidebar - Teal Theme */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #1a5a5e 0%, #0d3d40 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .sidebar-header {
            padding: 25px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.1);
        }
        .sidebar-header img { width: 45px; height: 45px; border-radius: 10px; }
        .sidebar-header h2 { font-size: 20px; font-weight: 700; }
        .sidebar-header span { font-size: 11px; opacity: 0.7; display: block; margin-top: 2px; }

        .sidebar-menu { padding: 20px 0; }
        .menu-label {
            padding: 12px 20px 8px;
            font-size: 11px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.4);
            letter-spacing: 1.5px;
            font-weight: 600;
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 20px;
            color: rgba(255,255,255,0.75);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            margin: 2px 0;
        }
        .menu-item:hover {
            background: rgba(36, 176, 186, 0.15);
            color: white;
            border-left-color: rgba(36, 176, 186, 0.5);
        }
        .menu-item.active {
            background: linear-gradient(90deg, rgba(36, 176, 186, 0.3) 0%, transparent 100%);
            border-left-color: #24b0ba;
            color: #24b0ba;
        }
        .menu-item .icon { font-size: 20px; width: 28px; text-align: center; }
        .menu-item span { font-size: 14px; font-weight: 500; }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 15px 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ff6b6b;
            text-decoration: none;
            font-size: 14px;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        .logout-btn:hover { background: rgba(255,107,107,0.1); }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            min-height: 100vh;
        }

        /* Top Header */
        .top-header {
            background: linear-gradient(135deg, #24b0ba, #1a8a93);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .page-title h1 { font-size: 24px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .page-title p { font-size: 13px; opacity: 0.9; margin-top: 5px; }
        .header-actions { display: flex; gap: 10px; }

        /* Content Area */
        .content-area { padding: 25px 30px; }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .search-box {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .search-input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            width: 280px;
            outline: none;
            transition: border-color 0.3s;
        }
        .search-input:focus { border-color: #24b0ba; }
        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            background: white;
            cursor: pointer;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-header h3 { font-size: 16px; font-weight: 600; color: #333; }
        .card-body { padding: 20px; }

        /* Form */
        .form-card { margin-bottom: 20px; display: none; }
        .form-card.active { display: block; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #555;
            margin-bottom: 6px;
        }
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        .form-control:focus { border-color: #24b0ba; }
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        /* Table */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: #333;
        }
        .data-table tr:hover { background: #f8fffe; }
        .data-table tr:last-child td { border-bottom: none; }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        .btn-primary {
            background: linear-gradient(135deg, #24b0ba, #1a8a93);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(36,176,186,0.4); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-outline {
            background: transparent;
            border: 2px solid #24b0ba;
            color: #24b0ba;
        }
        .btn-outline:hover { background: #24b0ba; color: white; }

        /* Message */
        .message {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            font-size: 14px;
        }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; display: block; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; display: block; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }
        .empty-state h4 { font-size: 18px; color: #555; margin-bottom: 8px; }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar { width: 70px; }
            .sidebar-header h2, .sidebar-header span, .menu-label, .menu-item span { display: none; }
            .sidebar-header { justify-content: center; padding: 15px; }
            .menu-item { justify-content: center; padding: 15px; }
            .main-content { margin-left: 70px; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
            .action-bar { flex-direction: column; align-items: stretch; }
            .search-input { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/img/logo.png" alt="Logo">
                <div>
                    <h2>MyAssessment</h2>
                    <span>Sistem Penilaian K13</span>
                </div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-label">Menu Utama</div>
                <a href="index.html" class="menu-item">
                    <span class="icon">üè†</span>
                    <span>Dashboard</span>
                </a>
                <a href="siswa.html" class="menu-item active">
                    <span class="icon">üë•</span>
                    <span>Data Siswa</span>
                </a>
                <a href="kompetensi.html" class="menu-item">
                    <span class="icon">üìö</span>
                    <span>Kompetensi Dasar</span>
                </a>
                <a href="penilaian.html" class="menu-item">
                    <span class="icon">üìù</span>
                    <span>Input Penilaian</span>
                </a>
                
                <div class="menu-label">Laporan</div>
                <a href="penilaian.html" class="menu-item">
                    <span class="icon">üìä</span>
                    <span>Rekap Nilai</span>
                </a>
                <a href="penilaian.html" class="menu-item">
                    <span class="icon">üìÑ</span>
                    <span>Cetak Rapor</span>
                </a>
                
                <div class="menu-label">Pengaturan</div>
                <a href="pengaturan.html" class="menu-item">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Pengaturan</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="login.html" class="logout-btn" onclick="logout()">
                    <span>üö™</span>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <div class="top-header">
                <div class="page-title">
                    <h1>üë• Data Siswa</h1>
                    <p>Kelola data siswa lengkap dengan informasi akademik</p>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Message -->
                <div class="message" id="message"></div>

                <!-- Action Bar -->
                <div class="action-bar">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="üîç Cari siswa..." onkeyup="searchStudents()">
                        <select class="filter-select" id="filterKelas" onchange="filterStudents()">
                            <option value="">Semua Kelas</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="showForm()">+ Tambah Siswa</button>
                        <button class="btn btn-outline" onclick="exportCSV()">üìä Export</button>
                    </div>
                </div>

                <!-- Form Card -->
                <div class="card form-card" id="formCard">
                    <div class="card-header">
                        <h3 id="formTitle">‚ûï Tambah Siswa Baru</h3>
                        <button class="btn btn-sm btn-secondary" onclick="hideForm()">‚úï Tutup</button>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>NISN</label>
                                <input type="text" class="form-control" id="nisn" placeholder="Masukkan NISN">
                            </div>
                            <div class="form-group">
                                <label>Nama Lengkap</label>
                                <input type="text" class="form-control" id="nama" placeholder="Masukkan nama lengkap">
                            </div>
                            <div class="form-group">
                                <label>Kelas</label>
                                <select class="form-control" id="kelas">
                                    <option value="">Pilih Kelas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Jenis Kelamin</label>
                                <select class="form-control" id="gender">
                                    <option value="">Pilih Jenis Kelamin</option>
                                    <option value="Laki-laki">Laki-laki</option>
                                    <option value="Perempuan">Perempuan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tanggal Lahir</label>
                                <input type="date" class="form-control" id="tanggalLahir">
                            </div>
                            <div class="form-group">
                                <label>Alamat</label>
                                <input type="text" class="form-control" id="alamat" placeholder="Masukkan alamat">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveStudent()">üíæ Simpan</button>
                            <button class="btn btn-secondary" onclick="hideForm()">Batal</button>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Daftar Siswa</h3>
                        <span id="totalCount">0 siswa</span>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <table class="data-table" id="studentTable">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>NISN</th>
                                    <th>Nama Lengkap</th>
                                    <th>Kelas</th>
                                    <th>L/P</th>
                                    <th>Tgl Lahir</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="studentBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = '/api';
        let students = [];
        let kelasList = [];
        let editingId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadKelasOptions();
            loadStudents();
        });

        async function loadKelasOptions() {
            try {
                const res = await fetch(`${API_URL}/kelas`);
                kelasList = await res.json();
                
                const filterKelas = document.getElementById('filterKelas');
                filterKelas.innerHTML = '<option value="">Semua Kelas</option>';
                kelasList.forEach(k => filterKelas.innerHTML += `<option value="${k.nama}">${k.nama}</option>`);
                
                const formKelas = document.getElementById('kelas');
                formKelas.innerHTML = '<option value="">Pilih Kelas</option>';
                kelasList.forEach(k => formKelas.innerHTML += `<option value="${k.nama}">${k.nama}</option>`);
            } catch (err) { console.error('Error loading kelas:', err); }
        }

        async function loadStudents() {
            try {
                const res = await fetch(`${API_URL}/siswa`);
                students = await res.json();
                renderStudents();
            } catch (err) {
                showMessage('Gagal memuat data siswa', 'error');
            }
        }

        function renderStudents(data = students) {
            const tbody = document.getElementById('studentBody');
            document.getElementById('totalCount').textContent = `${data.length} siswa`;
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="icon">üë•</div><h4>Belum ada data siswa</h4><p>Klik "Tambah Siswa" untuk menambah data</p></div></td></tr>`;
                return;
            }

            tbody.innerHTML = data.map((s, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${s.nisn}</td>
                    <td><strong>${s.nama}</strong></td>
                    <td>${s.kelas}</td>
                    <td>${s.gender === 'Laki-laki' ? 'L' : 'P'}</td>
                    <td>${formatDate(s.tanggalLahir)}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="editStudent('${s.id}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent('${s.id}')">üóëÔ∏è Hapus</button>
                    </td>
                </tr>
            `).join('');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('id-ID');
        }

        function showForm() {
            document.getElementById('formCard').classList.add('active');
            document.getElementById('formTitle').textContent = '‚ûï Tambah Siswa Baru';
            clearForm();
            editingId = null;
        }

        function hideForm() {
            document.getElementById('formCard').classList.remove('active');
            clearForm();
            editingId = null;
        }

        function clearForm() {
            ['nisn', 'nama', 'kelas', 'gender', 'tanggalLahir', 'alamat'].forEach(id => document.getElementById(id).value = '');
        }

        async function saveStudent() {
            const student = {
                nisn: document.getElementById('nisn').value,
                nama: document.getElementById('nama').value,
                kelas: document.getElementById('kelas').value,
                gender: document.getElementById('gender').value,
                tanggalLahir: document.getElementById('tanggalLahir').value,
                alamat: document.getElementById('alamat').value
            };

            if (!student.nisn || !student.nama || !student.kelas) {
                showMessage('Mohon lengkapi NISN, Nama, dan Kelas!', 'error');
                return;
            }

            try {
                const url = editingId ? `${API_URL}/siswa/${editingId}` : `${API_URL}/siswa`;
                const method = editingId ? 'PUT' : 'POST';
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(student)
                });
                const result = await res.json();
                showMessage(result.message, 'success');
                hideForm();
                loadStudents();
            } catch (err) {
                showMessage('Gagal menyimpan data', 'error');
            }
        }

        function editStudent(id) {
            const s = students.find(x => x.id === id);
            if (s) {
                document.getElementById('nisn').value = s.nisn;
                document.getElementById('nama').value = s.nama;
                document.getElementById('kelas').value = s.kelas;
                document.getElementById('gender').value = s.gender;
                document.getElementById('tanggalLahir').value = s.tanggalLahir;
                document.getElementById('alamat').value = s.alamat || '';
                document.getElementById('formCard').classList.add('active');
                document.getElementById('formTitle').textContent = '‚úèÔ∏è Edit Data Siswa';
                editingId = id;
            }
        }

        async function deleteStudent(id) {
            if (confirm('Yakin ingin menghapus data siswa ini?')) {
                try {
                    const res = await fetch(`${API_URL}/siswa/${id}`, { method: 'DELETE' });
                    const result = await res.json();
                    showMessage(result.message, 'success');
                    loadStudents();
                } catch (err) {
                    showMessage('Gagal menghapus data', 'error');
                }
            }
        }

        function searchStudents() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            renderStudents(students.filter(s => s.nama.toLowerCase().includes(term) || s.nisn.includes(term)));
        }

        function filterStudents() {
            const kelas = document.getElementById('filterKelas').value;
            renderStudents(kelas ? students.filter(s => s.kelas === kelas) : students);
        }

        function exportCSV() {
            let csv = 'NISN,Nama,Kelas,Jenis Kelamin,Tanggal Lahir,Alamat\n';
            students.forEach(s => csv += `${s.nisn},${s.nama},${s.kelas},${s.gender},${s.tanggalLahir},"${s.alamat || ''}"\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'DataSiswa.csv';
            a.click();
            showMessage('Data berhasil diekspor!', 'success');
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => msg.className = 'message', 3000);
        }

        function logout() {
            localStorage.removeItem('userSession');
            sessionStorage.removeItem('userSession');
        }
    </script>
</body>
</html>
